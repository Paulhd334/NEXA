<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S'inscrire - NEXA</title>
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase compat (plus simple) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    
    <style>
        /* RESET */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: 70px;
        }
        
        /* HEADER SIMPLE */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            background: #000;
            border-bottom: 1px solid #333;
            z-index: 1000;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            text-decoration: none;
        }
        
        /* MAIN CONTENT */
        .main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-card {
            background: #111;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-title {
            font-size: 28px;
            margin-bottom: 30px;
            color: #fff;
        }
        
        /* ALERTES */
        #alert-container {
            margin-bottom: 20px;
            min-height: 50px;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .alert-info {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .alert-success {
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .alert-error {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        /* BOUTON GOOGLE */
        .google-btn {
            width: 100%;
            padding: 16px;
            background: #fff;
            color: #000;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .google-btn:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
        }
        
        .google-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .google-btn.loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #000;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* LIEN CONNEXION */
        .login-link {
            color: #999;
            font-size: 14px;
            margin-top: 20px;
        }
        
        .login-link a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            margin-left: 5px;
        }
        
        .login-link a:hover {
            text-decoration: underline;
        }
        
        /* DEBUG PANEL */
        .debug-panel {
            background: #222;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 12px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        .debug-title {
            color: #999;
            font-weight: 600;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .debug-log {
            color: #2ecc71;
            font-family: monospace;
            margin: 5px 0;
        }
        
        .debug-error {
            color: #e74c3c;
        }
        
        /* FOOTER */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #333;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #999;
            text-decoration: none;
        }
        
        .footer-links a:hover {
            color: #fff;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <a href="index.html" class="logo">NEXA</a>
    </header>
    
    <!-- Main Content -->
    <main class="main">
        <div class="login-card">
            <h1 class="login-title">S'inscrire</h1>
            
            <!-- Messages d'alerte -->
            <div id="alert-container">
                <div class="alert alert-info" id="init-alert">
                    Initialisation de l'authentification...
                </div>
            </div>
            
            <!-- Bouton Google -->
            <button class="google-btn" id="googleSignup">
                <i class="fab fa-google"></i>
                <span>S'inscrire avec Google</span>
            </button>
            
            <!-- Lien connexion -->
            <div class="login-link">
                D√©j√† un compte ? <a href="login.html">Se connecter</a>
            </div>
            
            <!-- Panel de debug -->
            <div class="debug-panel" id="debugPanel">
                <div class="debug-title" onclick="toggleDebug()">
                    üîç Debug Console (cliquez pour √©tendre)
                </div>
                <div id="debugLogs"></div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-links">
            <a href="legals/conditions-utilisation.html">Conditions</a>
            <a href="legals/politique-confidentialite.html">Confidentialit√©</a>
        </div>
        <div>¬© 2024 UNWARE STUDIO</div>
    </footer>
    
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBnFg0G5xNgUNLeGtywVRKhtVCI6Yi1UHI",
            authDomain: "unware-studio-b540a.firebaseapp.com",
            projectId: "unware-studio-b540a",
            storageBucket: "unware-studio-b540a.firebasestorage.app",
            messagingSenderId: "65599188762",
            appId: "1:65599188762:web:b8cfb7c89d6daf752646a3",
            measurementId: "G-PGF09J1QP8"
        };
        
        // √âl√©ments DOM
        const googleBtn = document.getElementById('googleSignup');
        const alertContainer = document.getElementById('alert-container');
        const debugPanel = document.getElementById('debugPanel');
        const debugLogs = document.getElementById('debugLogs');
        const initAlert = document.getElementById('init-alert');
        
        // Log de debug
        function logDebug(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const log = document.createElement('div');
            log.className = `debug-log ${type === 'error' ? 'debug-error' : ''}`;
            log.textContent = `[${time}] ${message}`;
            debugLogs.appendChild(log);
            debugPanel.scrollTop = debugLogs.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }
        
        // Toggle debug panel
        function toggleDebug() {
            debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
        }
        
        // Afficher une alerte
        function showAlert(message, type = 'info', duration = 5000) {
            alertContainer.innerHTML = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;
            
            if (duration > 0 && type !== 'success') {
                setTimeout(() => {
                    alertContainer.innerHTML = '';
                }, duration);
            }
        }
        
        // Initialiser Firebase
        logDebug("üî• D√©marrage de l'initialisation Firebase...");
        
        try {
            // Initialiser Firebase
            firebase.initializeApp(firebaseConfig);
            logDebug("‚úÖ Firebase app initialis√©e");
            
            // R√©cup√©rer l'auth
            const auth = firebase.auth();
            logDebug("‚úÖ Service d'authentification charg√©");
            
            // V√©rifier la config
            logDebug(`üìã Projet: ${firebaseConfig.projectId}`);
            logDebug(`üåê Domaine: ${firebaseConfig.authDomain}`);
            
            // Mettre √† jour l'alerte
            initAlert.textContent = "‚úÖ Authentification pr√™te ! Cliquez sur le bouton Google.";
            initAlert.className = "alert alert-success";
            
            // Afficher le panel de debug
            debugPanel.style.display = 'block';
            logDebug("üöÄ Syst√®me pr√™t. Cliquez sur le bouton Google.");
            
            // G√©rer le clic sur le bouton Google
            googleBtn.addEventListener('click', async () => {
                logDebug("üñ±Ô∏è Clic sur le bouton Google d√©tect√©");
                
                try {
                    // Activer le mode chargement
                    googleBtn.classList.add('loading');
                    googleBtn.disabled = true;
                    logDebug("‚è≥ D√©but de l'authentification Google...");
                    
                    // Cr√©er le provider Google
                    const provider = new firebase.auth.GoogleAuthProvider();
                    provider.addScope('email');
                    provider.addScope('profile');
                    
                    logDebug("üì® Ouverture de la popup Google...");
                    
                    // Essayer avec popup
                    const result = await auth.signInWithPopup(provider);
                    
                    logDebug("‚úÖ Authentification Google r√©ussie !");
                    logDebug(`üë§ Utilisateur: ${result.user.email}`);
                    
                    // Succ√®s
                    showAlert(`üéâ Bienvenue ${result.user.displayName} !`, 'success', 3000);
                    
                    // Changer le bouton
                    googleBtn.innerHTML = '<i class="fas fa-check"></i><span>Connexion r√©ussie !</span>';
                    googleBtn.style.background = '#2ecc71';
                    googleBtn.style.color = '#fff';
                    
                    // Stocker les infos utilisateur
                    localStorage.setItem('user', JSON.stringify({
                        uid: result.user.uid,
                        email: result.user.email,
                        name: result.user.displayName,
                        photo: result.user.photoURL,
                        timestamp: new Date().toISOString()
                    }));
                    
                    logDebug("üíæ Utilisateur enregistr√© dans localStorage");
                    
                    // Redirection apr√®s 2 secondes
                    setTimeout(() => {
                        logDebug("üîÄ Redirection vers le tableau de bord...");
                        window.location.href = 'dashboard.html';
                    }, 2000);
                    
                } catch (error) {
                    // Erreur
                    logDebug(`‚ùå Erreur: ${error.code} - ${error.message}`, 'error');
                    console.error("Erreur d√©taill√©e:", error);
                    
                    // R√©activer le bouton
                    googleBtn.classList.remove('loading');
                    googleBtn.disabled = false;
                    
                    // Messages d'erreur en fran√ßais
                    let errorMessage = "Erreur lors de la connexion";
                    
                    switch(error.code) {
                        case 'auth/popup-blocked':
                            errorMessage = "La popup a √©t√© bloqu√©e. Autorisez les popups pour ce site.";
                            break;
                        case 'auth/popup-closed-by-user':
                            errorMessage = "Vous avez ferm√© la fen√™tre de connexion.";
                            break;
                        case 'auth/unauthorized-domain':
                            errorMessage = "Ce domaine n'est pas autoris√©. Ajoutez-le dans Firebase Console.";
                            break;
                        case 'auth/operation-not-allowed':
                            errorMessage = "L'authentification Google n'est pas activ√©e dans Firebase.";
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = "Probl√®me de r√©seau. V√©rifiez votre connexion.";
                            break;
                        default:
                            errorMessage = `Erreur: ${error.message}`;
                    }
                    
                    showAlert(errorMessage, 'error');
                    
                    // Afficher les instructions si n√©cessaire
                    if (error.code === 'auth/unauthorized-domain' || error.code === 'auth/operation-not-allowed') {
                        logDebug("üìã INSTRUCTIONS: Allez dans Firebase Console ‚Üí Authentication ‚Üí Sign-in method ‚Üí Activez Google", 'error');
                        logDebug("üìã INSTRUCTIONS: Ajoutez ce domaine dans les domaines autoris√©s", 'error');
                    }
                }
            });
            
            // V√©rifier si d√©j√† connect√©
            auth.onAuthStateChanged((user) => {
                if (user) {
                    logDebug(`üîì Utilisateur d√©j√† connect√©: ${user.email}`);
                    showAlert(`Bon retour ${user.displayName || user.email} !`, 'success');
                    googleBtn.style.display = 'none';
                    
                    // Rediriger
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                } else {
                    logDebug("üîí Aucun utilisateur connect√©");
                }
            });
            
        } catch (error) {
            // Erreur d'initialisation Firebase
            logDebug(`‚ùå ERREUR INIT FIREBASE: ${error.message}`, 'error');
            console.error("Erreur Firebase:", error);
            
            initAlert.textContent = "‚ùå Erreur d'initialisation Firebase. V√©rifiez la console.";
            initAlert.className = "alert alert-error";
            
            // Afficher les instructions
            logDebug("üìã SOLUTION: V√©rifiez votre configuration Firebase", 'error');
            logDebug("üìã SOLUTION: Allez dans https://console.firebase.google.com/", 'error');
            logDebug("üìã SOLUTION: S√©lectionnez votre projet unware-studio-b540a", 'error');
            logDebug("üìã SOLUTION: Activez Authentication ‚Üí Google Sign-in", 'error');
            
            // Mode d√©mo si Firebase √©choue
            googleBtn.addEventListener('click', () => {
                showAlert("‚ö†Ô∏è Mode d√©mo: Firebase non configur√©. Activez Google Sign-in dans Firebase Console.", 'info');
                logDebug("üîÑ Mode d√©mo activ√© - Configurez Firebase pour l'authentification r√©elle", 'error');
            });
        }
        
        // Instructions dans la console
        console.log(`
        ===================================================
        üî• FIREBASE TROUBLESHOOTING
        ===================================================
        
        SI RIEN NE SE PASSE:
        
        1. ‚úÖ V√©rifiez que la console ne montre pas d'erreur (F12)
        2. üîß Activez l'authentification Google:
           - https://console.firebase.google.com/
           - Projet: unware-studio-b540a
           - Authentication ‚Üí Sign-in method
           - Cliquez sur "Google"
           - Activez et sauvegardez
        
        3. üåê Ajoutez votre domaine:
           - Authentication ‚Üí Settings
           - Domaines autoris√©s:
             * http://localhost:5500
             * https://nexa-neon.vercel.app
             * Votre domaine
        
        4. üöÄ Testez imm√©diatement:
           - Rechargez cette page
           - Cliquez sur "S'inscrire avec Google"
           - Une popup Google devrait s'ouvrir
        
        ===================================================
        `);
    </script>
</body>
</html>
